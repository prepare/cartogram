<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>cartogram2 2 - Circles Test</title>
        <style type="text/css">
            body {
                margin: 0;
                padding: 0;
            }

            #controls {
                position: absolute;
                top: 0;
                left: 0;
                z-index: 10;
                background: white;
                padding: 20px;
                width: 200px;
            }
        </style>
    </head>
    <body>
        <div id="container"></div>
        <div id="controls">
            Curve <input id="curve" type="range" min="-200" max="200" value="0" step="1" /> <br />
            Skew <input id="skew" type="range" min="-100" max="100" value="0" step="1" />
        </div>

        <script type="text/javascript" src="../node_modules/three/three.js"></script>
        <script type="text/javascript" src="../node_modules/lodash/index.js"></script>
        <script type="text/javascript" src="../dist/cartogram-dev.js"></script>
        <script type="text/javascript">
            window.curve = 0;
            window.skew = 0;

            var curveEl = document.getElementById('curve');
            var skewEl = document.getElementById('skew');

            function newCurve(curve, skew) {
                var circles = [],
                    curvePoints = cartogram2.utils.curveGenerators.linearSpacedQuadraticBezierCurve(
                    { x: 0, y: -1*skew, },
                    { x: 225, y: curve, },
                    { x: 450, y: skew, },
                    5
                );

                var curveLinePoints = cartogram2.utils.curveGenerators.quadraticBezierCurve(
                    { x: 0, y: -1*skew, },
                    { x: 225, y: curve, },
                    { x: 450, y: skew, },
                    500
                );

                for (var i=0; i < curveLinePoints.length; i++) {
                    circles.push({
                        type: 'PointCircle',
                        name: 'line' + i,
                        radius: 2,
                        position: {
                            x: curveLinePoints[i].x,
                            y: curveLinePoints[i].y,
                            z: 0
                        },
                        fill: { r: 1, g: 1, b: 1 }
                    });
                }
                for (var i=0; i < curvePoints.length; i++) {
                    circles.push({
                        type: 'PointCircle',
                        name: 'point' + i,
                        radius: 20,
                        position: {
                            x: curvePoints[i].x,
                            y: curvePoints[i].y,
                            z: 0
                        },
                        fill: { r: Math.random(), g: Math.random(), b: Math.random() }
                    });
                }

                return circles;
            }

            function updateActors(circles, scene) {
                circles.forEach(function(circle) {
                    scene.actorAtPath('thing/cloud').set(circle.name, {
                        position: circle.position
                    });
                });
            }

            var cartogram = new cartogram2(document.getElementById('container'), {
                backgroundColor: '#000000'
            });

            var scene = cartogram.getDefaultScene();

            cartogram.registerType('HoverCircle', {
                parent: 'PointCircle',
                onMouseover: function(state) {
                    this.set('oldFill', state.fill);
                    this.set('fill', { r: 0, g: 0, b: 1.0 });
                },
                onMouseout: function(state) {
                    this.set('fill', state.oldFill);
                    this.set('oldFill', undefined);
                }
            });
            var range = 2000;

            console.time('add actor')
            var actor = {
                name: 'cloud',
                position: { x: 0, y: 0, z: 0 },
                shapes: newCurve(window.curve, window.skew)
            };
            scene.addGroup({
                name: 'thing',
                actors: [actor]
            });

            console.timeEnd('add actor')

            var cameraController = new cartogram2.PanAndZoomCameraController({
                buttons: {
                    0: 'pan',
                    3: 'zoom'
                }
            });
            scene.addCameraController(cameraController);

            curveEl.addEventListener('change', function() {
                window.curve = this.value;
                updateActors(
                    newCurve(window.curve, window.skew),
                    scene
                );
            });

            skewEl.addEventListener('change', function() {
                window.skew = this.value;
                updateActors(
                    newCurve(window.curve, window.skew),
                    scene
                );
            });

            cartogram.render();
        </script>
    </body>
</html>
